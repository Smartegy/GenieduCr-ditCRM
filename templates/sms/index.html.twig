
{% extends 'base.html.twig' %}
{% set page_title = 'Envoyer SMS' %}
{% set P_page_title = 'Leads' %}
{% set P_path = '/leads' %} 
{% block body %}


 
     <!--begin::Main-->
    <!--begin::Root-->
    <div class="d-flex flex-column flex-root">
        <!--begin::Page-->
        
       
        <div class="card mb-5 mb-xl-10">
            <div class="card-body pt-9 pb-0">
                <!--begin::Details-->
                <div class="d-flex flex-wrap flex-sm-nowrap mb-3">
                   
                     <!--begin::Info-->
                    <div class="flex-grow-1">
                        <!--begin::Title-->
                        <div class="d-flex justify-content-between align-items-start flex-wrap mb-2">
                            <!--begin::User-->
                            <div class="d-flex flex-column">
                                <!--begin::Name-->
                                <div class="d-flex align-items-center mb-2">
                                    <a href="#" class="text-gray-900 text-hover-primary fs-2 fw-bolder me-1" >{{lead.nom}}</a>
                   

                                </div>
                                <!--end::Name-->
                                <!--begin::Info-->
                                <div class="d-flex flex-wrap fw-bold fs-6 mb-4 pe-2">
                                    <a href="#" class="d-flex align-items-center text-gray-400 text-hover-primary me-5 mb-2">
                                        <!--begin::Svg Icon | path: icons/duotune/communication/com006.svg-->
                                        <span class="svg-icon svg-icon-4 me-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path opacity="0.3" d="M22 12C22 17.5 17.5 22 12 22C6.5 22 2 17.5 2 12C2 6.5 6.5 2 12 2C17.5 2 22 6.5 22 12ZM12 7C10.3 7 9 8.3 9 10C9 11.7 10.3 13 12 13C13.7 13 15 11.7 15 10C15 8.3 13.7 7 12 7Z" fill="black"></path>
                                                <path d="M12 22C14.6 22 17 21 18.7 19.4C17.9 16.9 15.2 15 12 15C8.8 15 6.09999 16.9 5.29999 19.4C6.99999 21 9.4 22 12 22Z" fill="black"></path>
                                            </svg>
                                        </span>
                                        <!--end::Svg Icon-->{{lead.Statusleads.nom}}</a>
                                   

                                </div>
                                <div class="d-flex flex-wrap fw-bold fs-6 mb-4 pe-2">

                                    <a href="#" class="d-flex align-items-center text-gray-400 text-hover-primary mb-2" id="uniqlead">
                                        <!--begin::Svg Icon | path: icons/duotune/communication/com011.svg-->
                                        <span class="svg-icon svg-icon-4 me-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path opacity="0.3" d="M21 19H3C2.4 19 2 18.6 2 18V6C2 5.4 2.4 5 3 5H21C21.6 5 22 5.4 22 6V18C22 18.6 21.6 19 21 19Z" fill="black"></path>
                                                <path d="M21 5H2.99999C2.69999 5 2.49999 5.10005 2.29999 5.30005L11.2 13.3C11.7 13.7 12.4 13.7 12.8 13.3L21.7 5.30005C21.5 5.10005 21.3 5 21 5Z" fill="black"></path>
                                            </svg>
                                        </span>
                                        <!--end::Svg Icon-->{{lead.courriel}}</a>
                                </div>
                                <!--end::Info-->
                            </div>
                            <!--end::User-->

                        </div>
                        <!--end::Title-->
                        <!--begin::Stats-->
          
                        <!--end::Stats-->
                    </div>
                    <!--end::Info-->
                </div>
                <!--end::Details--> 
                <!--begin::Navs-->
                <ul class="nav nav-stretch nav-line-tabs nav-line-tabs-2x border-transparent fs-5 fw-bolder">
                    <!--begin::Nav item-->
                    <li class="nav-item mt-2">
                        <a class="nav-link text-active-primary ms-0 me-10 py-5 active" href="{{path("leads_show",{ 'id' : lead.Id})}}">Aperçu</a>
                        
                    </li>
                    <!--end::Nav item-->
                    <!--begin::Nav item-->
                    <li class="nav-item mt-2">
                        <a class="nav-link text-active-primary ms-0 me-10 py-5" href="{{path("leads_edit",{ 'id' : lead.Id})}}">Modification</a>
                    </li>
                    <!--end::Nav item-->
                 
                    <!--begin::Nav item-->
                    <li class="nav-item mt-2">
                        <a class="nav-link text-active-primary ms-0 me-10 py-5" href="{{path('notes_index', {'idlead' : lead.id})}}">Notes</a>
                    </li>
                    <li class="nav-item mt-2">
                        <a class="nav-link text-active-primary ms-0 me-10 py-5" href="{{path('files_index', {'idlead' : lead.id})}}">Documents Attaché</a>
                    </li>

                      <li class="nav-item mt-2">
                        <a class="nav-link text-active-primary ms-0 me-10 py-5" href="{{path('courriel', {'idlead' : lead.id})}}">Courriel</a>
                    </li>
                    <li class="nav-item mt-2">
                        <a class="nav-link text-active-primary ms-0 me-10 py-5" href="#">SMS</a>
                    </li>
                    <!--end::Nav item-->

                </ul>
                <!--begin::Navs-->
            </div>
        </div>
						<!--begin::Post-->
  
                      
                    
                        <div class="d-flex flex-column flex-lg-row">
                            <!--begin::Sidebar-->
                            <div class="flex-column flex-lg-row-auto w-100 w-lg-300px w-xl-400px mb-10 mb-lg-0">
                                <!--begin::Contacts-->
                                <div class="card card-flush">
                                 
                                    <div class="card-body pt-5" id="kt_chat_contacts_body">
                                        <!--begin::List-->
                                        <div>
                                   
                                            <div class="d-flex flex-stack py-4">
                                                <!--begin::Details-->
                                                <div class="d-flex align-items-center">
                                                 
                                                    <!--begin::Details-->
                                                    {{ form_start(form) }}
                                                    <div style="display:none;"> {{ form_row(form.lead)}}</div>
                                                    <div style="display:none;"> {{ form_row(form.emetteur)}}</div>
                                                    <div style="display:none;"> {{ form_row(form.recepteur)}}</div>
                                                    
                                                 

                                                    <div class="ms-5">
                                                        <div class="fs-5 fw-bolder text-gray-900 text-hover-primary mb-2">Modéle Sms</div>
                                                        <div class="row mb-6" >
                                           
    
                                                    
                                                                {{ form_widget(form.modele , {'id': 'modele','attr': {'class': 'form-control form-control-lg form-control-solid'}}) }}
                                                                {{ form_errors(form.modele) }}
                                                       
                                                        </div>
                                                        <div >
                                                            {% for mod in modelesms %}
                  
                                                                 <div class="credsEarned" >
                                                                 <div class="js-user-rating" style="display:none;" >{{mod.id}}</div> 
                                                                 
                                                              
                                                                 <div class="message-rating" style="display:none;">{{mod.message}}</div> 
                                                                 
                                                             </div>
                                                     
                                                            {% endfor %}
                 
                                                         </div>
                                                    </div>
                                                
                                                    <!--end::Details-->
                                                </div>
                                                <!--end::Details-->
                                                <!--begin::Lat seen-->
                                            
                                                <!--end::Lat seen-->
                                            </div>
                                            <!--end::User-->
                                        </div>
                                        <!--end::List-->
                                    </div>
                                    <!--end::Card body-->
                                </div>
                                <!--end::Contacts-->
                            </div>
                            <!--end::Sidebar-->
                            <!--begin::Content-->
                            <div class="flex-lg-row-fluid ms-lg-7 ms-xl-10">
                                <!--begin::Messenger-->
                                <div class="card" id="kt_chat_messenger">
                                    <!--begin::Card header-->
                                    <div class="card-header" id="kt_chat_messenger_header">
                                        <!--begin::Title-->
                                        <div class="card-title">
                                            <!--begin::User-->
                                            <div class="d-flex justify-content-center flex-column me-3">
                                                <a href="#" class="fs-4 fw-bolder text-gray-900 text-hover-primary me-1 mb-2 lh-1">{{lead.nom}}</a>
                                                <!--begin::Info-->
                                                <div class="mb-0 lh-1">
                                                    <span class="badge badge-success badge-circle w-10px h-10px me-1"></span>
                                                    <span class="fs-7 fw-bold text-muted">{{lead.Statusleads.nom}}</span>
                                                </div>
                                                <!--end::Info-->
                                            </div>
                                            <!--end::User-->
                                        </div>
                                     
                                    </div>
                                    <!--end::Card header-->
                                    <!--begin::Card body-->
                                    <div class="card-body" id="kt_chat_messenger_body">
                                        <!--begin::Messages-->
                                        <div class="scroll-y me-n5 pe-5 h-300px h-lg-auto" data-kt-element="messages" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_header, #kt_toolbar, #kt_footer, #kt_chat_messenger_header, #kt_chat_messenger_footer" data-kt-scroll-wrappers="#kt_content, #kt_chat_messenger_body" data-kt-scroll-offset="5px">
                                            <!--begin::Message(in)-->
                                            {% for e in history %}
                                           
                                           
                                                        <!--begin::Avatar-->
                                                       
                                                        <!--end::Avatar-->
                                                        <!--begin::Details-->
                                                       
                                                         
                                                    {% if e.emetteur == lead.telephone %}
                                                            <div class="d-flex justify-content-start mb-10">
                                                                <!--begin::Wrapper-->
                                                                <div class="d-flex flex-column align-items-start">
                                                                    <!--begin::User-->
                                                                    <div class="d-flex align-items-center mb-2">

                                                                        <div class="symbol symbol-50 me-4">
                                                                            <div class="symbol-label bg-light-danger">
                                                                                <span class="text-danger">{{lead.nom|slice(0)[:1]}}</span>
                                                                            </div>
                                                                        </div>
                                                                 <div class="ms-3">
                                                                    <a href="#" class="fs-5 fw-bolder text-gray-900 text-hover-primary me-1">{{lead.nom}} </a>
                                                                    <span class="text-muted fs-7 mb-1">{{e.datecreation ? e.datecreation|date('Y-m-d-h-s') : '' }}</span>
                                                                   </div>
                                                                </div>
                                                                   <div class="p-5 rounded bg-light-info text-dark fw-bold mw-lg-400px text-start" data-kt-element="message-text">{{e.text}}</div>
                                                                
                                                                <!--end::User-->
                                                                <!--begin::Text-->
                                                               
                                                                <!--end::Text-->
                                                            </div>
                                                            <!--end::Wrapper-->
                                                             </div>
                                                 {% else %}
                                                                {% for userr in user %}
                                                                    {% if e.emetteur == userr.telephone %}
                                                                    {% if  userr.nomutilisateur == app.user.nomutilisateur %}
                                                                    <div class="d-flex justify-content-end mb-10">
                                                                        <!--begin::Wrapper-->
                                                                        <div class="d-flex flex-column align-items-end">
                                                                            <!--begin::User-->
                                                                            <div class="d-flex align-items-center mb-2">
                                                                                <!--begin::Details-->
                                                                                <div class="me-3">
                                                                                    <span class="text-muted fs-7 mb-1">{{e.datecreation ? e.datecreation|date('Y-m-d-h-s') : '' }}</span>
                                                                                    <a href="#" class="fs-5 fw-bolder text-gray-900 text-hover-primary ms-1">Vous</a>
                                                                                </div>
                                                                                <!--end::Details-->
                                                                                <!--begin::Avatar-->
                                                                                <div class="symbol symbol-50 me-4">
                                                                                    <div class="symbol-label bg-light-primary">
                                                                                        <span class="text-primary">{{userr.nomutilisateur|slice(0)[:1]}}</span>
                                                                                    </div>
                                                                                  </div>
                                                                                <!--end::Avatar-->
                                                                            </div>
                                                                            <!--end::User-->
                                                                            <!--begin::Text-->
                                                                            <div class="p-5 rounded bg-light-primary text-dark fw-bold mw-lg-400px text-end" data-kt-element="message-text">{{e.text}}</div>
                                                                            <!--end::Text-->
                                                                        </div>
                                                                        <!--end::Wrapper-->
                                                                    </div>
                                                                    {% else %}
                                                                    <div class="d-flex justify-content-end mb-10">
                                                                        <!--begin::Wrapper-->
                                                                        <div class="d-flex flex-column align-items-end">
                                                                            <!--begin::User-->
                                                                            <div class="d-flex align-items-center mb-2">
                                                                                <!--begin::Details-->
                                                                                <div class="me-3">
                                                                                    <span class="text-muted fs-7 mb-1">{{e.datecreation ? e.datecreation|date('Y-m-d-h-s') : '' }}</span>
                                                                                    <a href="#" class="fs-5 fw-bolder text-gray-900 text-hover-primary ms-1">{{userr.nomutilisateur}}</a>
                                                                                </div>
                                                                                <!--end::Details-->
                                                                                <!--begin::Avatar-->
                                                                                <div class="symbol symbol-50 me-4">
                                                                                    <div class="symbol-label bg-light-primary">
                                                                                        <span class="text-primary">{{userr.nomutilisateur|slice(0)[:1]}}</span>
                                                                                    </div>
                                                                                  </div>
                                                                                <!--end::Avatar-->
                                                                            </div>
                                                                            <!--end::User-->
                                                                            <!--begin::Text-->
                                                                            <div class="p-5 rounded bg-light-primary text-dark fw-bold mw-lg-400px text-end" data-kt-element="message-text">{{e.text}}</div>
                                                                            <!--end::Text-->
                                                                        </div>
                                                                        <!--end::Wrapper-->
                                                                    </div>
                                                                    {% endif %}
                                                                    {% endif %}
                                                                {% endfor %}
                                                      {% endif %}
                                                           
                                                        
                                                        <!--end::Details-->
                                                 
                                            <!--end::Message(in)-->
                                            <!--begin::Message(out)-->
                                          

                                         {% endfor %}
                                        </div>
                                        <!--end::Messages-->
                                    </div>
                                    <!--end::Card body-->
                                    <!--begin::Card footer-->
                                    <div class="card-footer pt-4" id="kt_chat_messenger_footer">
                                        <!--begin::Input-->
                                        <div class="form-control form-control-flush mb-3" rows="5" data-kt-element="input" placeholder="Type a message">

                                            {{ form_widget(form.text, {'id': 'text','attr': {'class': 'form-control form-control-lg form-control-solid'}}) }}
                                            {{ form_errors(form.text) }}

                                        </div>
                                      
                                        <!--end::Input-->
                                        <!--begin:Toolbar-->
                                        <div class="d-flex flex-stack">
                                            <!--begin::Actions-->
                                            <div class="d-flex align-items-center me-2">
                                             
                                            </div>
                                          

                                           


                                            <!--end::Actions-->
                                            <!--begin::Send-->
                                            <button class="btn btn-primary" type="submit" data-kt-element="send"> Envoyer</button>
                                            <!--end::Send-->
                                        </div>
                                        <!--end::Toolbar-->
                                    </div>
                                    <!--end::Card footer-->
                                </div>
                                <!--end::Messenger-->
                            </div>
                            <!--end::Content-->
                            {{ form_end(form) }}
                        </div>
 
 	 


 	{{ include('layout/pagination.html.twig') }}
<script>
							$("#kt_datatable_example_5").DataTable({
 "language": {
        "lengthMenu": "Afficher _MENU_",
        "sSearch":        "Rechercher:",
     
        
        "sLengthMenu":    "Mostrar _MENU_ registros",
        "sZeroRecords":   "No se encontraron resultados",
        "sEmptyTable":    "Pas de données pour cette liste",
        
         "sInfo":          "Affichage de _START_ à _END_ sur un total de _TOTAL_ enregistrements",
         "oPaginate": {
           
            "sNext":    "Suivant",
            "sPrevious": "Précédent"
        }     
     
 },
 "dom":
  "<'row'" +
  "<'col-sm-6 d-flex align-items-center justify-conten-start'l>" +
  "<'col-sm-6 d-flex align-items-center justify-content-end'f>" +
  ">" +

  "<'table-responsive'tr>" +

  "<'row'" +
  "<'col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start'i>" +
  "<'col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end'p>" +
  ">"
});
</script>

<script type="text/javascript">

		$(document).ready(function(){

			var theHREF;
			$(".confirmModalLink").click(function(e) {
					e.preventDefault();
					theHREF = $(this).attr("href");
					console.log(theHREF);
					$("#kt_modal_1").modal("show");
				});

				$("#confirmModalNo").click(function(e) {
					$("#kt_modal_1").modal("hide");
				});

				$("#confirmModalYes").click(function(e) {
				//	window.location.href = theHREF;
					$('#myform'). attr('action', theHREF);

					document.getElementById("myform").submit();
				});

		});

</script> 
  
<script  type="text/javascript">

$("#modele").on("change", function(e) {
  e.preventDefault();           
     var a=(this.value);         
     var contexts = $('.credsEarned');
      clickvalue=this.value;
      console.log(this.value);
     for(var i = 0;i<contexts.length;i++){
            var context = contexts[i];
            myid= $(context).find( ".js-user-rating" ).html();
            mymessage= $(context).find( "div.message-rating" ).html();

                        if( clickvalue == myid )  
                        {
                            document.getElementById('text').value = mymessage;
        
                        }

                        else
                        {  }
                    }
                    if (clickvalue == "" )
                    {
                        document.getElementById('text').value = " ";
                       
                    }
  }); 



</script>





{% endblock %} 

